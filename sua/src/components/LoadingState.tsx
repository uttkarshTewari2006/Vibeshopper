import { useEffect, useRef } from 'react';
// anime.js v4 API
// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore
import { animate, svg } from 'animejs';

interface LoadingStateProps {
  message?: string;
}

export function LoadingState({ message = "Loading..." }: LoadingStateProps) {
  const pathRef = useRef<SVGPathElement>(null);
  const cartRef = useRef<HTMLDivElement>(null);

  // racepath.svg path data
  const racePathD = 'M2 93H41.1107C61.1364 93 80.2677 84.7057 93.9563 70.089L103.709 59.6748C117.895 44.5269 114.23 20.1075 96.2218 9.79208V9.79208C86.1931 4.0475 73.8431 4.13257 63.889 10.0055V10.0055C46.3719 20.3406 42.6755 44.1337 56.2548 59.2752L65.1027 69.141C78.7199 84.3249 98.1528 93 118.548 93H161.5';

  useEffect(() => {
    if (!pathRef.current || !cartRef.current) return;

    // Map transforms to the SVG path coordinates using anime.js
    const motion = svg.createMotionPath(pathRef.current);
    const { translateX, translateY, rotate } = motion;

    animate(cartRef.current, {
      ease: 'linear',
      duration: 3000,
      loop: true,
      translateX,
      translateY,
      rotate,
    });
  }, []);

  return (
    <div className="text-center py-8">
      <div className="relative w-48 h-24 mx-auto mb-4">
        {/* racepath.svg */}
        <svg 
          width="164" 
          height="95" 
          viewBox="0 0 164 95" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          className="w-full h-full"
        >
          <path 
            ref={pathRef}
            d={racePathD}
            stroke="#A898F5" 
            strokeWidth="4"
          />
          <circle cx="161.5" cy="93" r="2" fill="#A898F5"/>
          <circle cx="2" cy="93" r="2" fill="#A898F5"/>
        </svg>
        
        {/* cart.svg animated along the path */}
        <div 
          ref={cartRef}
          className="absolute top-0 left-0 transform -translate-x-1/2 -translate-y-1/2"
        >
          <svg 
            width="20" 
            height="20" 
            viewBox="0 0 24 24" 
            fill="none" 
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clipPath="url(#clip0_30_77)">
              <path d="M0.999979 2.13003H3.59998C3.93764 2.12793 4.26599 2.24057 4.53125 2.4495C4.79651 2.65844 4.98293 2.95128 5.05998 3.28003L6.17998 7.93003C6.19336 7.98648 6.22524 8.03684 6.27054 8.07308C6.31585 8.10932 6.37197 8.12937 6.42998 8.13003H22.91C23.0678 8.12962 23.2234 8.16656 23.3642 8.23782C23.505 8.30908 23.6269 8.41264 23.72 8.54003C23.8129 8.66825 23.8741 8.8167 23.8984 8.97317C23.9227 9.12964 23.9096 9.28965 23.86 9.44003L21.19 17.44C21.1246 17.6405 20.9975 17.8152 20.8269 17.9391C20.6563 18.0631 20.4509 18.1299 20.24 18.13H8.89998C8.86199 18.1288 8.82424 18.1363 8.78958 18.1519C8.75493 18.1675 8.72428 18.1908 8.69998 18.22C8.68538 18.2531 8.67783 18.2889 8.67783 18.325C8.67783 18.3612 8.68538 18.397 8.69998 18.43L8.80998 18.93C8.82336 18.9865 8.85524 19.0368 8.90054 19.0731C8.94585 19.1093 9.00197 19.1294 9.05998 19.13H19.08C19.5227 19.1399 19.9527 19.2802 20.3161 19.5333C20.6795 19.7864 20.9601 20.1412 21.1227 20.5531C21.2854 20.965 21.3229 21.4157 21.2305 21.8488C21.1381 22.2819 20.92 22.6782 20.6034 22.9879C20.2868 23.2975 19.8859 23.5069 19.4509 23.5898C19.0158 23.6726 18.566 23.6252 18.1578 23.4536C17.7496 23.2819 17.4011 22.9936 17.156 22.6247C16.9109 22.2559 16.7801 21.8229 16.78 21.38C16.7795 21.3462 16.7722 21.3128 16.7585 21.2818C16.7447 21.2509 16.7248 21.2231 16.7 21.2C16.6784 21.1768 16.652 21.1585 16.6226 21.1464C16.5933 21.1343 16.5617 21.1288 16.53 21.13H10.53C10.4637 21.13 10.4001 21.1564 10.3532 21.2033C10.3063 21.2501 10.28 21.3137 10.28 21.38C10.2786 21.7648 10.1786 22.1428 9.98953 22.4779C9.80044 22.813 9.52857 23.094 9.1999 23.2941C8.87123 23.4941 8.49675 23.6066 8.11224 23.6206C7.72772 23.6347 7.34603 23.5499 7.00362 23.3744C6.66122 23.1989 6.36954 22.9385 6.15647 22.6181C5.9434 22.2977 5.81605 21.928 5.7866 21.5444C5.75714 21.1608 5.82656 20.776 5.98822 20.4268C6.14988 20.0776 6.39838 19.7758 6.70998 19.55C6.75018 19.5239 6.78074 19.4853 6.79698 19.4402C6.81323 19.395 6.81428 19.3458 6.79998 19.3L3.27998 4.30003C3.25988 4.24388 3.2211 4.19635 3.17012 4.16539C3.11914 4.13444 3.05907 4.12196 2.99998 4.13003H0.999979C0.734763 4.13003 0.480408 4.02468 0.292871 3.83714C0.105335 3.6496 -2.09808e-05 3.39525 -2.09808e-05 3.13003C-2.09808e-05 2.86482 0.105335 2.61046 0.292871 2.42293C0.480408 2.23539 0.734763 2.13003 0.999979 2.13003Z" fill="#5433EB"/>
              <path d="M14.2 7.13003H8.91001C8.7209 7.1323 8.53502 7.08088 8.37395 6.98176C8.21287 6.88264 8.08321 6.73988 8.00001 6.57003C7.91578 6.40399 7.87957 6.21772 7.89547 6.03222C7.91137 5.84671 7.97875 5.66932 8.09001 5.52003L10.07 3.00003L10.16 2.89003C10.4638 2.58654 10.8756 2.41606 11.305 2.41606C11.7344 2.41606 12.1462 2.58654 12.45 2.89003L14.92 5.43003C15.0582 5.57102 15.1516 5.74977 15.1884 5.94375C15.2252 6.13772 15.2037 6.33825 15.1267 6.52004C15.0497 6.70184 14.9206 6.85678 14.7557 6.96533C14.5908 7.07389 14.3974 7.13119 14.2 7.13003ZM22.6 6.53003C22.5219 6.70891 22.3932 6.86103 22.2298 6.96765C22.0663 7.07427 21.8752 7.13071 21.68 7.13003H17.37C17.2044 7.12809 17.0418 7.08505 16.897 7.00476C16.7521 6.92447 16.6294 6.80945 16.54 6.67003C16.4398 6.52517 16.3796 6.35639 16.3655 6.18079C16.3515 6.00519 16.3841 5.82899 16.46 5.67003L18.46 1.25003C18.556 1.04385 18.6948 0.860494 18.8673 0.712198C19.0397 0.563903 19.2418 0.454074 19.46 0.390033C19.8757 0.289502 20.3139 0.346502 20.69 0.550033L23 1.61003C23.3923 1.7914 23.699 2.11779 23.8557 2.5206C24.0123 2.92342 24.0067 3.37128 23.84 3.77003L22.6 6.53003Z" fill="#C71D60" fillOpacity="0.5"/>
            </g>
            <defs>
              <clipPath id="clip0_30_77">
                <rect width="24" height="24" fill="white" transform="matrix(-1 0 0 1 24 0)"/>
              </clipPath>
            </defs>
          </svg>
        </div>
      </div>
      <p className="text-gray-500 text-sm">{message}</p>
    </div>
  );
}
